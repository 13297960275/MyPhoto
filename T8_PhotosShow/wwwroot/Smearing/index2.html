<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>HTML5流星雨</title>
    <script src="./lufylegend-1.7.7.js" type="text/javascript"></script>
    <script src="./Smearing.js" type="text/javascript"></script>
    <script>
        init(10, "mylegend", 500, 400, main);
        var backLayer, meteorLayer;
        var back, meteor;
        var maxFrame = 40, indexFrame = 0;
        function main() {
            LStage.setDebug(true);

            //加入底板层
            backLayer = new LSprite();
            addChild(backLayer);
            //加入流星层
            meteorLayer = new LSprite();
            addChild(meteorLayer);

            //画一个黑色矩形作为背景
            back = new LGraphics();
            back.drawRect(0, "", [0, 0, LStage.width, LStage.height], true, "black");
            backLayer.addChild(back);

            //画一个黄色矩形作为一颗流星
            meteor = new LSprite();
            meteor.graphics.drawRect(0, "", [0, 0, 10, 10], true, "yellow");



            backLayer.addEventListener(LEvent.ENTER_FRAME, onframe);
        }
        function onframe() {
            if (indexFrame > maxFrame) {
                indexFrame = 0;
                //为每个流星添加一个拖尾
                var smearing = new Smearing(meteor, 50);
                smearing.x = Math.floor(Math.random() * 250);
                smearing.y = 0;
                smearing.to(2, {
                    x: Math.floor(Math.random() * (500 - 480) + 480),
                    y: 400
                });
                meteorLayer.addChild(smearing);
            }
            for (var key in meteorLayer.childList) {
                if (meteorLayer.childList[key].mode == "complete") {
                    meteorLayer.removeChild(meteorLayer.childList[key]);
                }
            }
            indexFrame++;
        }
    </script>
</head>
<body>
    <div id="mylegend">loading……</div>
</body>
</html>